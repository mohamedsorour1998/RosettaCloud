<div class="feedback-flow-container">
  <h1 class="feedback-flow-title">
    RosettaCloud Feedback Service Architecture
  </h1>
  <p class="feedback-flow-subtitle">
    Event-driven serverless architecture for providing AI-generated educational
    feedback
  </p>

  <div class="feedback-flow-diagram">
    <!-- Row 1: Angular Frontend -->
    <div class="flow-section">
      <div class="flow-row">
        <div
          class="flow-box client-box animated-box"
          (click)="toggleNodeDetails('angularFrontend')"
        >
          <img src="assets/icons/angular.svg" alt="Angular" class="tech-icon" />
          <div class="box-title">Angular Frontend</div>
          <div class="box-content">
            User interface for requesting and viewing feedback
          </div>
        </div>
      </div>

      <div *ngIf="expandedNode === 'angularFrontend'" class="details-panel">
        <h3 class="details-title">{{ nodeDetails.angularFrontend.title }}</h3>
        <p class="details-subtitle">
          {{ nodeDetails.angularFrontend.description }}
        </p>
        <ul class="details-list">
          <li *ngFor="let detail of nodeDetails.angularFrontend.details">
            {{ detail }}
          </li>
        </ul>
        <div class="code-block">
          <pre><code>{{ nodeDetails.angularFrontend.code }}</code></pre>
        </div>
      </div>
    </div>

    <!-- Connection arrows between sections -->
    <div class="flow-arrow arrow-down">
      <i class="bi bi-arrow-down arrow-icon"></i>
      <div class="arrow-label">API Gateway</div>
    </div>

    <!-- Row 2: Lambda Functions -->
    <div class="flow-section">
      <div class="flow-row">
        <div
          class="flow-box lambda-box animated-box"
          (click)="toggleNodeDetails('tokenVending')"
        >
          <img src="assets/icons/lambda.svg" alt="Lambda" class="tech-icon" />
          <div class="box-title">Momento Token Vending</div>
          <div class="box-content">
            Authenticates and provides temporary tokens
          </div>
        </div>

        <div
          class="flow-box lambda-box animated-box"
          (click)="toggleNodeDetails('feedbackRequest')"
        >
          <img src="assets/icons/lambda.svg" alt="Lambda" class="tech-icon" />
          <div class="box-title">Feedback Request</div>
          <div class="box-content">
            Processes feedback requests and publishes to Momento
          </div>
        </div>
      </div>

      <div *ngIf="expandedNode === 'tokenVending'" class="details-panel">
        <h3 class="details-title">{{ nodeDetails.tokenVending.title }}</h3>
        <p class="details-subtitle">
          {{ nodeDetails.tokenVending.description }}
        </p>
        <ul class="details-list">
          <li *ngFor="let detail of nodeDetails.tokenVending.details">
            {{ detail }}
          </li>
        </ul>
        <div class="code-block">
          <pre><code>{{ nodeDetails.tokenVending.code }}</code></pre>
        </div>
      </div>

      <div *ngIf="expandedNode === 'feedbackRequest'" class="details-panel">
        <h3 class="details-title">{{ nodeDetails.feedbackRequest.title }}</h3>
        <p class="details-subtitle">
          {{ nodeDetails.feedbackRequest.description }}
        </p>
        <ul class="details-list">
          <li *ngFor="let detail of nodeDetails.feedbackRequest.details">
            {{ detail }}
          </li>
        </ul>
        <div class="code-block">
          <pre><code>{{ nodeDetails.feedbackRequest.code }}</code></pre>
        </div>
      </div>
    </div>

    <!-- Connection arrows between sections -->
    <div class="flow-arrow arrow-down">
      <i class="bi bi-arrow-down arrow-icon"></i>
      <div class="arrow-label">WebSocket / Topics</div>
    </div>

    <!-- Row 3: Momento -->
    <div class="flow-section">
      <div class="flow-row">
        <div
          class="flow-box pub-sub-box animated-box"
          (click)="toggleNodeDetails('momento')"
        >
          <img src="assets/icons/momento.svg" alt="Momento" class="tech-icon" />
          <div class="box-title">Momento Pub/Sub</div>
          <div class="box-content">
            Real-time messaging backbone with Topics
          </div>
        </div>
      </div>

      <div *ngIf="expandedNode === 'momento'" class="details-panel">
        <h3 class="details-title">{{ nodeDetails.momento.title }}</h3>
        <p class="details-subtitle">
          {{ nodeDetails.momento.description }}
        </p>
        <ul class="details-list">
          <li *ngFor="let detail of nodeDetails.momento.details">
            {{ detail }}
          </li>
        </ul>
        <div class="code-block">
          <pre><code>{{ nodeDetails.momento.code }}</code></pre>
        </div>
      </div>
    </div>

    <!-- Connection arrows between sections -->
    <div class="flow-arrow arrow-down">
      <i class="bi bi-arrow-down arrow-icon"></i>
      <div class="arrow-label">Subscribe & Publish</div>
    </div>

    <!-- Row 4: Backend Service -->
    <div class="flow-section">
      <div class="flow-row">
        <div
          class="flow-box backend-box animated-box"
          (click)="toggleNodeDetails('feedbackService')"
        >
          <img src="assets/icons/python.svg" alt="Python" class="tech-icon" />
          <div class="box-title">Feedback Service</div>
          <div class="box-content">Processes feedback requests with AI</div>
        </div>
      </div>

      <div *ngIf="expandedNode === 'feedbackService'" class="details-panel">
        <h3 class="details-title">{{ nodeDetails.feedbackService.title }}</h3>
        <p class="details-subtitle">
          {{ nodeDetails.feedbackService.description }}
        </p>
        <ul class="details-list">
          <li *ngFor="let detail of nodeDetails.feedbackService.details">
            {{ detail }}
          </li>
        </ul>
        <div class="code-block">
          <pre><code>{{ nodeDetails.feedbackService.code }}</code></pre>
        </div>
      </div>
    </div>

    <!-- Connection arrows between sections -->
    <div class="flow-arrow arrow-down">
      <i class="bi bi-arrow-down arrow-icon"></i>
      <div class="arrow-label">API Calls</div>
    </div>

    <!-- Row 5: AI Service -->
    <div class="flow-section">
      <div class="flow-row">
        <div
          class="flow-box ai-box animated-box"
          (click)="toggleNodeDetails('aiService')"
        >
          <img src="assets/icons/bedrock.svg" alt="AI" class="tech-icon" />
          <div class="box-title">AI Service</div>
          <div class="box-content">
            Generates educational feedback with Nova LLM
          </div>
        </div>
      </div>

      <div *ngIf="expandedNode === 'aiService'" class="details-panel">
        <h3 class="details-title">{{ nodeDetails.aiService.title }}</h3>
        <p class="details-subtitle">
          {{ nodeDetails.aiService.description }}
        </p>
        <ul class="details-list">
          <li *ngFor="let detail of nodeDetails.aiService.details">
            {{ detail }}
          </li>
        </ul>
        <div class="code-block">
          <pre><code>{{ nodeDetails.aiService.code }}</code></pre>
        </div>
      </div>
    </div>

    <!-- Row 6: Display Component -->
    <div class="flow-section">
      <div class="flow-row">
        <div
          class="flow-box display-box animated-box"
          (click)="toggleNodeDetails('displayComponent')"
        >
          <img src="assets/icons/ui.svg" alt="UI" class="tech-icon" />
          <div class="box-title">Feedback Display</div>
          <div class="box-content">Renders and manages feedback UI</div>
        </div>
      </div>

      <div *ngIf="expandedNode === 'displayComponent'" class="details-panel">
        <h3 class="details-title">{{ nodeDetails.displayComponent.title }}</h3>
        <p class="details-subtitle">
          {{ nodeDetails.displayComponent.description }}
        </p>
        <ul class="details-list">
          <li *ngFor="let detail of nodeDetails.displayComponent.details">
            {{ detail }}
          </li>
        </ul>
        <div class="code-block">
          <pre><code>{{ nodeDetails.displayComponent.code }}</code></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Process Steps Section -->
  <div class="process-steps">
    <h2 class="steps-title">Complete Flow Process</h2>
    <ol class="steps-list">
      <li *ngFor="let step of steps" class="step-item">
        <div class="step-number">{{ step.number }}</div>
        <div class="step-content">
          <p class="step-description">{{ step.description }}</p>
          <div class="step-flow">
            <span class="flow-from">{{ step.from }}</span>
            <i class="bi bi-arrow-right"></i>
            <span class="flow-to">{{ step.to }}</span>
          </div>
        </div>
      </li>
    </ol>
  </div>

  <!-- Key Information -->
  <div class="key-info">
    <h2 class="key-info-title">Key Information</h2>
    <div class="info-cards">
      <div class="info-card">
        <div class="card-icon"><i class="bi bi-lightning"></i></div>
        <h3 class="card-title">Event-Driven</h3>
        <p class="card-text">
          Uses event-based architecture with publish/subscribe messaging for
          real-time responses.
        </p>
      </div>
      <div class="info-card">
        <div class="card-icon"><i class="bi bi-shield-check"></i></div>
        <h3 class="card-title">Secure</h3>
        <p class="card-text">
          Temporary tokens, scoped permissions, and user verification ensure
          security.
        </p>
      </div>
      <div class="info-card">
        <div class="card-icon"><i class="bi bi-arrow-repeat"></i></div>
        <h3 class="card-title">Resilient</h3>
        <p class="card-text">
          Error handling, retry mechanisms, and connection monitoring provide
          reliability.
        </p>
      </div>
    </div>
  </div>
</div>
